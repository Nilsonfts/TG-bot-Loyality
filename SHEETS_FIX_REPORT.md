# ИСПРАВЛЕНИЕ ПРОБЛЕМЫ С ОБНОВЛЕНИЕМ GOOGLE SHEETS

## Проблема
Бот не мог обновлять ячейки в Google Sheets из-за несоответствия названий столбцов в константах и реальных заголовков в таблице.

## Обнаруженные ошибки
1. **Переносы строк в заголовках**: В таблице заголовки содержали переносы строк (`\n`), а в константах их не было
2. **Пробелы в конце заголовков**: Многие заголовки в таблице имели пробелы в конце
3. **Специальные символы**: В заголовке "Сумма бартера или  %  скидки" было два пробела вокруг символа %

## Исправления

### 1. Обновлены константы в `constants.py`
Исправлены все названия столбцов для точного соответствия заголовкам в Google Sheets:

```python
class SheetCols:
    TG_ID = 'ID\nИнициатора'  # Добавлен перенос строки
    TG_TAG = 'ТГ\nИнициатора'  # Добавлен перенос строки
    FIO_INITIATOR = 'ФИО \nИнициатора'  # Добавлен пробел и перенос
    PHONE_INITIATOR = 'Телефон\nИнициатора'  # Добавлен перенос строки
    OWNER_FIRST_NAME_COL = 'Имя владельца карты '  # Добавлен пробел в конце
    # ... и другие заголовки с точными совпадениями
    APPROVAL_STATUS = 'Согласовано САД/Директором по рекламе '  # Добавлен пробел в конце
```

### 2. Улучшена функция `update_cell_by_row` в `g_sheets.py`
- Добавлена более надежная система поиска заголовков
- Добавлено подробное логирование для отладки
- Добавлены алгоритмы нормализации и частичного совпадения как fallback

### 3. Добавлена отладочная функция
Создана функция `debug_sheet_headers()` для диагностики проблем с заголовками.

## Результат
✅ Все заголовки теперь точно совпадают  
✅ Функция обновления ячеек должна работать корректно  
✅ Администраторы смогут одобрять/отклонять заявки  
✅ Данные будут корректно записываться в Google Sheets

## Тестирование
Проведено тестирование соответствия всех 20 заголовков - все показали точное совпадение.
